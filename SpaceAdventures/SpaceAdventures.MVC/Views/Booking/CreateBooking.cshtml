@model SpaceAdventures.MVC.Models.BookingVm

@{
    ViewData["Title"] = "CreateBooking";
}

<link rel="stylesheet" href="~/css/Booking.css" asp-append-version="true" />

<h1 class="text-white">Create a Booking</h1>

@{
    var flightList = new SelectList("","");
}

<hr />
<div class="row flex-container column">
    <div class="col-md-4">
        <form asp-action="CreateBooking">
            <div asp-validation-summary="ModelOnly" class="text-danger "></div>
            <div class="form-group">
                <label asp-for="Lastname" class="control-label text-white"></label>
                <input asp-for="Lastname" class="form-control BiggerBox" />
                <span asp-validation-for="Lastname" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="FirstName" class="control-label text-white"></label>
                <input asp-for="FirstName" class="form-control BiggerBox" />
                <span asp-validation-for="FirstName" class="text-danger"></span>
            </div>

            <div class="form-group">
                <label asp-for="IdItinerary" class="control-label text-white"></label>

                @Html.DropDownListFor(x => Model.IdItinerary, new SelectList(@ViewBag.itinerariesSelectList, "Text", "Value"), htmlAttributes: new { @class = "form-control BiggerBox", id="IdItinerary"})

                <span asp-validation-for="IdItinerary" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="IdFlight" class="control-label text-white"></label>
                @Html.DropDownListFor(x => Model.IdFlight, new SelectList(flightList, "Text", "Value"), htmlAttributes: new { @class = "form-control BiggerBox", id="IdFlight"})
                <span asp-validation-for="IdFlight" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="NbSeats" class="control-label text-white BiggerBox"></label>
                <input asp-for="NbSeats" class="form-control BiggerBox" id="NbSeatsChange" />
                <span asp-validation-for="NbSeats" class="text-danger"></span>
            </div>
            
            <div class="form-group">
                <label class="control-label text-white BiggerBox"> Booking amount</label>
                <input id="AmountCalculation"  class="form-control BiggerBox" readonly="readonly" />
            </div>

            <div class="form-group">
                <input type="submit" value="Create" class="btn btn-primary" />
            </div>
        </form>
    </div>
</div>

<div class="flex-container column">
    <video controls autoplay name="media">
        <source src="@ViewBag.video" type="video/mp4">
        Your browser does not support the video tag.
    </video>
</div>

<div>
    <a asp-action="Index">Back to List</a>
</div>

@section Scripts {
    @{
    await Html.RenderPartialAsync("_ValidationScriptsPartial");
}


    <script type="text/javascript">

        $("#IdItinerary").change(function () {
            var selectedItinerary = $("#IdItinerary").val();
            var FlightSelect = $("#IdFlight");
            FlightSelect.empty();


            if (selectedItinerary != null && selectedItinerary != '') {
                $.getJSON('@Url.Action("GetFlightsByItinerary","Flights")', { idItinerary: selectedItinerary }, function(flights) {
                        if (flights != null)
                        {
                            FlightSelect.append($('<option/>', {
                                value: null,
                                text: "--- Select Flight ---"
                            }));
                            $.each(flights, function (index,flight) {
                                FlightSelect.append($('<option/>', {
                                    value: flight.value,
                                    text: flight.text
                                }));
                            });
                        }
                    }
                );
            }
        });

        $("#NbSeatsChange").blur(function() {
            var Amount = $("#AmountCalculation");
            var Nbseat = $("#NbSeatsChange").val();
            var Flight = $("#IdFlight").val();
            Amount.empty();

            if (Nbseat != null && Nbseat != '' && Flight!= null && Flight != '') {
                $.getJSON('@Url.Action("GetFlightById","Flights")', { IdFlight: Flight }, function(t) {
                    
                    var value = (parseInt(Nbseat) * (t.price));
                    $("#AmountCalculation").val(value);
                });
            };
        });

    </script>
    


}
