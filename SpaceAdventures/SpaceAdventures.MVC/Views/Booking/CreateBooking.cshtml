@model SpaceAdventures.MVC.Models.BookingVm

@{
    ViewData["Title"] = "CreateBooking";
}

<link rel="stylesheet" href="~/css/Booking.css" asp-append-version="true" />

<h1 class="text-white">Create a Booking</h1>

@{
    var flightList = new SelectList("","");
}

<hr />
<div class="row flex-container column">
    <div class="col-md-4">
        <form asp-action="CreateBooking">
            <div asp-validation-summary="ModelOnly" class="text-danger "></div>
            <div class="form-group">
                <label asp-for="Lastname" class="control-label text-white"></label>
                <input asp-for="Lastname" class="form-control BiggerBox" />
                <span asp-validation-for="Lastname" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="FirstName" class="control-label text-white"></label>
                <input asp-for="FirstName" class="form-control BiggerBox" />
                <span asp-validation-for="FirstName" class="text-danger"></span>
            </div>

            <div class="form-group">
                <label asp-for="IdItinerary" class="control-label text-white"></label>

                @Html.DropDownListFor(x => Model.IdItinerary, new SelectList(@ViewBag.itinerariesSelectList, "Text", "Value"), htmlAttributes: new { @class = "form-control BiggerBox", id="IdItinerary"})

                <span asp-validation-for="IdItinerary" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="IdFlight" class="control-label text-white"></label>
                @Html.DropDownListFor(x => Model.IdItinerary, new SelectList(flightList, "Text", "Value"), htmlAttributes: new { @class = "form-control BiggerBox", id="IdFlight"})
                <span asp-validation-for="IdFlight" class="text-danger"></span>
            </div>
            <div class="form-group">
                <input type="submit" value="Create" class="btn btn-primary" />
            </div>
        </form>
    </div>
</div>

<div class="flex-container column">
    <video controls autoplay name="media">
        <source src="@ViewBag.video" type="video/mp4">
        Your browser does not support the video tag.
    </video>
</div>

<div>
    <a asp-action="Index">Back to List</a>
</div>

@section Scripts {
    @{
    await Html.RenderPartialAsync("_ValidationScriptsPartial");
}


<script type="text/javascript">
    $("#IdItinerary").change(function () {
    var selectedItinerary = $("#IdItineray").val();
    //var depotDepartSelect = $("#IDDepotDepart");
    //var depotRetourSelect = $("#IDDepotRetour");
    //depotDepartSelect.empty();
    //depotRetourSelect.empty();
    flightList = $("#IdFlights");
    flightList.empty(); if (selectedItinerary != null && selectedItinerary != '') {
    $.getJSON('@Url.Action("GetFlightsByItinerary","Flight")', { idItinerary: selectedItinerary }, function(flights) {
        if (flights != null)
            {
                flightList.append($('<option/>', {
                value: null,
                text: "--- Select Flight ---"
                }));
                $.each(flight, function (index,flight) {
                flightList.append($('<option/>', {
                value: flight.IdFlight,
                text: "Departure time : "+flight.DepartureTime+" -- Arrival Time : "+flight.ArrivalTime + " (Remaining seats : " + flight.RemainingSeats + ") -- Price : "+flight.Price
                }));
                });
            }
            }
            );
            }
            });


    
</script>


}
